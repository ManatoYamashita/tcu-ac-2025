# セットアップガイド

このガイドでは、manapuraza blog の開発環境を構築する手順を説明します。

## 前提条件

以下のソフトウェアがインストールされていることを確認してください：

- **Node.js**: v18.17.0 以上（v20.x 推奨）
- **npm**: v9.0.0 以上 または **yarn**: v1.22.0 以上
- **Git**: v2.30.0 以上

バージョン確認コマンド：

```bash
node --version
npm --version
git --version
```

## 1. リポジトリのクローン

GitHubからプロジェクトをクローンします：

```bash
git clone https://github.com/ManatoYamashita/crypto-blogs.git
cd crypto-blogs
```

## 2. 依存パッケージのインストール

プロジェクトルートで以下のコマンドを実行します：

```bash
npm install
```

または

```bash
yarn install
```

## 3. 環境変数の設定

### 3.1 暗号化キーの生成

記事の質問回答を暗号化するためのキーを生成します：

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

このコマンドは、64文字のHEX文字列を出力します。例：

```
aedb4c5529175dcef34d6d5aa21b0f18162955d9fd4c2571cf5bdd05724579a7
```

### 3.2 .env.local ファイルの作成

プロジェクトルートに `.env.local` ファイルを作成し、生成したキーを設定します：

```bash
cp .env.example .env.local
```

`.env.local` ファイルを開き、`ENCRYPTION_KEY` に生成したキーを設定します：

```env
# 暗号化キー（64文字のHEX文字列）
ENCRYPTION_KEY=aedb4c5529175dcef34d6d5aa21b0f18162955d9fd4c2571cf5bdd05724579a7
```

**重要:** `.env.local` ファイルは `.gitignore` に含まれているため、Gitにコミットされません。本番環境では Vercel の環境変数設定から同じキーを設定してください。

## 4. 開発サーバーの起動

以下のコマンドで開発サーバーを起動します：

```bash
npm run dev
```

または

```bash
yarn dev
```

サーバーが起動すると、以下のようなメッセージが表示されます：

```
▲ Next.js 16.0.5
- Local:        http://localhost:3000
```

## 5. 動作確認

ブラウザで http://localhost:3000 にアクセスし、以下を確認します：

1. **トップページ**: 「manapuraza blog」のタイトルと「記事一覧を見る」ボタンが表示される
2. **記事一覧**: `/blogs` にアクセスし、サンプル記事が表示される
3. **制限付き記事**: 🔒アイコンが付いた記事をクリックし、質問フォームが表示される

### 質問フォームのテスト

制限付き記事「制限付き記事サンプル」にアクセスし、以下の質問に答えてください：

1. **質問1**: 東京都市大学の略称は？
   - 正解: `TCU`（大文字小文字区別あり）

2. **質問2**: このブログのテーマは？
   - 選択肢から「技術ブログ」を選択

3. **質問3**: パスワード
   - 正解: `secret123`

全問正解すると、記事本文が表示されます。

## 6. 次のステップ

環境構築が完了したら、以下のドキュメントを参照してください：

- **記事を追加したい**: [管理者マニュアル](./admin-manual.md)を参照
- **システム構成を理解したい**: [システム概要](../architecture/overview.md)を参照
- **セキュリティについて知りたい**: [セキュリティモデル](../architecture/security.md)を参照

## トラブルシューティング

問題が発生した場合は、[トラブルシューティング](./troubleshooting.md)を参照してください。

## 本番環境へのデプロイ

Vercel へのデプロイ手順：

1. Vercel にログインし、GitHubリポジトリを接続
2. プロジェクト設定で環境変数 `ENCRYPTION_KEY` を設定（ローカルと同じ値）
3. デプロイを実行

**注意:** 本番環境とローカル環境で異なる `ENCRYPTION_KEY` を使用すると、暗号化された回答が正しく復号化できなくなります。必ず同じキーを使用してください。
